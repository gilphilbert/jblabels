<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?2=OmJ3Mz7X8k">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?2=OmJ3Mz7X8k">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?2=OmJ3Mz7X8k">
    <link rel="manifest" href="/site.webmanifest?2=OmJ3Mz7X8k">
    <link rel="mask-icon" href="/safari-pinned-tab.svg?2=OmJ3Mz7X8k" color="#eac03e">
    <link rel="shortcut icon" href="/favicon.ico?2=OmJ3Mz7X8k">
    <meta name="apple-mobile-web-app-title" content="Juke Studio">
    <meta name="application-name" content="Juke Studio">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="theme-color" content="#ffffff">

    <title>jukestudio</title>
    <link rel="stylesheet" href="assets/juke.css">
<style>
.is-center { text-align: center; }
#preview-strip { width: 50%; }
.navbar-brand img { height: 35px; width: auto; }
</style>
  </head>
  <body>
    <!-- START NAV -->
    <nav class="navbar is-danger">
      <div class="container">
        <div class="navbar-brand">
          <a class="navbar-item brand-text" href="#">
            <img src="images/logo.svg">
            <img src="images/brand.svg">
          </a>
          <div class="navbar-burger burger" data-target="navMenu">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
        <div id="navMenu" class="navbar-menu">
          <div class="navbar-start">
            <a class="navbar-item add-record" href="#">
              add record
            </a>
            <a class="navbar-item" href="#">
              design
            </a>
            <a class="navbar-item" href="#">
              print
            </a>
          </div>
        </div>
      </div>
    </nav>
    <!-- END NAV -->
    <!-- MAIN CONTENT -->
    <section class="section">
      <div class="container">
        <div class="columns">
          <div class="column is-12">
            <div class="card events-card">
              <header class="card-header">
                <p class="card-header-title">
                  Records
                </p>
              </header>
              <div class="card-table">
                 <div class="content">
                    <table class="table is-fullwidth is-striped" id="record-table">
                      <thead>
                        <tr>
                          <th>Print</th>
                          <th>Side A</th>
                          <th>Side B</th>
                          <th></th>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                </div>
                <footer>
                  &nbsp;
                </footer>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- END MAIN CONTENT -->

    <!-- MODALS -->

    <!-- WELCOME MODAL -->
    <div class="modal" id="welcome-modal">
      <div class="modal-background close-modal"></div>
        <div class="modal-card modal-small is-center">
          <header class="modal-card-head">
            <p class="modal-card-title">
              welcome to jukestudio
            </p>
          </header>
          <section class="modal-card-body">
            <img src="images/designs/arrows.svg" class="preview-strip">
            <p>to get started, click 'add record' menu to add your first record, then set some design options and click 'print'!</p>
          </section>
          <footer class="modal-card-foot columns">
            <button class="button column is-light close-modal">ok, i'm ready!</button>
          </footer>
        </div>
      </div>
    </div>
    <!-- END WELCOME MODAL -->

    <!-- ADD RECORD MODAL -->
    <div class="modal" id="add-record-modal">
      <div class="modal-background close-modal"></div>
        <div class="modal-card modal-small is-center">
          <header class="modal-card-head">
            <p class="modal-card-title">
              <img class="modal-card-head-img" src="images/record-dark.svg"/>
              <br>
              <span class="title-text">add record</span>
            </p>
          </header>
          <section class="modal-card-body">
            <div class="field">
              <div class="control">
                <input class="input" type="text" id="add-side-a" placeholder="side a">
              </div>
            </div>
            <div class="field">
              <div class="control">
                <input class="input" type="text" id="add-side-b" placeholder="side b">
              </div>
            </div>
            <div class="field">
              <div class="control">
                <input class="input" type="text" id="add-artist" placeholder="artist">
              </div>
            </div>
            <div class="field">
              <div class="control">
                <input class="input" type="text" id="add-artist-b" placeholder="side b artist (if different)">
              </div>
            </div>
            <img src="images/designs/arrows.svg" id="title-preview" class="preview-strip" />
            <div class="box">
              <div class="field">
                <label class="label">Style</label>
                <div class="control">
                  <div class="select">
                    <select id="title-style">
                    </select>
                  </div>
                </div>
              </div>
              <div class="field">
                <label class="label">Color</label>
                <div class="control">
                  <div class="select">
                    <select id="title-primaryColor">
                      <option value="#ff0000">Red</option>
                      <option value="#00a0de">Blue</option>
                      <option value="#5fae6f">Green</option>
                      <option value="#80578f">Purple</option>
                      <option value="#EE6B3F">Orange</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="field">
                <input class="is-checkradio" id="title-artistFillColor" type="checkbox" name="">
                <label for="title-artistFillColor">colored background for artist
              </div>
              <div class="field">
                <input class="is-checkradio" id="title-titleFillColor" type="checkbox" name="">
                <label for="title-titleFillColor">colored background for title</label>
              </div>
            </div>
          </section>
          <footer class="modal-card-foot columns">
            <button class="button column is-light close-modal">cancel</button>
            <button class="button column is-success">save</button>
          </footer>
        </div>
      </div>
    </div>
    <!-- END ADD RECORD MODAL -->

    <!-- DELETE MODAL -->
    <div class="modal" id="delete-modal">
      <div class="modal-background close-modal"></div>
        <div class="modal-card modal-small is-center">
          <header class="modal-card-head">
            <p class="modal-card-title">
              <img class="modal-card-head-img" src="images/record-dark.svg"/>
              <br>
              delete record
            </p>
          </header>
          <section class="modal-card-body">
            <p class="is-compact record-detail"></p>
            <br>
            <p>are you sure you want to delete this record?</p>
            <br>
          </section>
          <footer class="modal-card-foot columns">
            <button class="button column is-light close-modal">cancel</button>
            <button class="button column is-danger" id="delete-record">delete</button>
          </footer>
        </div>
      </div>
    </div>

    <!-- END MODALS -->
  </body>
<script>

//----- HELPER FUNCTIONS
function startApp() {

  //load the titles into the app
  var titles=titleCreator.getTitles();
  if(titles.length>0)
    addRow(titles);
  else
    document.querySelector('#record-table tbody').append(crel('tr',{'id':'no-records'},crel('td',{'colspan':'4','class':'is-center'},'no records! add a record to get started')));

  //only show the welcome screen the first time you visit
  if(!localStorage.getItem('welcome-hidden'))
    document.getElementById('welcome-modal').classList.add('is-active');
}

function addRow(content=null){
  if(content==null) return;

  var row;
  var fragment=document.createDocumentFragment();

  if(content.constructor!==Array)
    content=[content];

  var i;
  for(i=0;i<content.length;i++) {
    row=crel('tr',{'class':'is-compact','data-id':content[i].id},
      crel('td',{'class':'is-middle'},
        crel('div',{'class':'field'},
          crel('input',{'class':'is-checkradio print-check','data-id':content[i].id,'id':'printcheck'+content[i].id,'type':'checkbox'}),
          crel('label',{'for':'printcheck'+content[i].id})
        )
      ), //td
      crel('td',{'class':'aside'},
        crel('strong',content[i].aside),
        crel('br'),
        crel('small',content[i].artist)
      ), //td
      crel('td',{'class':'bside'},
        crel('strong',content[i].bside),
        crel('br'),
        crel('small',((content[i].artistb=='')?content[i].artist:content[i].artistb))
      ), //td
      crel('td',{'class':'is-middle'},
        crel('a',{'class':'button is-small is-danger delete-button','href':'#','data-modal':'open','data-target':'delete-modal'},'delete')
      ) //td
    ); //tr
    fragment.appendChild(row);
  }
  document.querySelector('#record-table tbody').appendChild(fragment);
}

function removeRow(id) {
  var row=document.querySelector('#record-table tr[data-id="'+id+'"]');
  row.parentNode.removeChild(row);
  if(document.querySelector('#record-table tbody tr')==null)
    document.querySelector('#record-table tbody').innerHTML='<tr id="no-records"><td colspan=4 class="is-center">no records! add a record to get started</td></tr>';
}

function toggleModal(id,dataID=null) {
  var m=document.getElementById(id);
  if(m.classList.contains('is-active')) {
    m.classList.remove('is-active');
    m.removeAttribute('data-id')
  } else {
    m.classList.add('is-active');
    if(dataID!==null)
      m.setAttribute('data-id',dataID)
  }
}

//----- END HELPER FUNCTIONS

//----- EVENT HANDLERS

document.getElementById('delete-record').addEventListener('click',function(e){
  var id=document.getElementById('delete-modal').dataset.id;
console.log(id);
  if(id!==undefined) {
    titleCreator.removeTitle(id);
    removeRow(id);
    document.getElementById('delete-modal').classList.remove('is-active'); 
  }
});

document.querySelectorAll('.close-modal').forEach(function(e){
  e.addEventListener('click', function (event) {
    var modal=event.target.closest('.modal');
    toggleModal(modal.id);
    if(modal.id=='welcome-modal')
      localStorage.setItem('welcome-hidden',true);
    else if(modal.id=="add-record-modal")
      document.querySelectorAll('#add-record-modal input').forEach(function(e){e.value=''});
  });
});

document.querySelectorAll('#record-table tbody').forEach(function(e){
  e.addEventListener('click', function (event) {
    if(event.target.classList.contains('delete-button')) {
      var rd=document.querySelector('#delete-modal .record-detail');
      while(rd.firstChild) { rd.removeChild(rd.firstChild) }
      var td=event.target.parentNode.parentNode.childNodes[1].cloneNode(true).childNodes;
      rd.append(td);
      toggleModal('delete-modal',event.target.parentNode.parentNode.dataset.id);
    } else {
      //edit the record
    }
  });
});

document.querySelector('.navbar .add-record').addEventListener('click', function(event) {
  toggleModal('add-record-modal');
  document.querySelector("#add-side-a").focus();
});

//----- END EVENT HANDLERS



//----- DETECT WHEN DOM IS LOADED AND START APP
if (document.readyState === "complete" || (document.readyState !== "loading" && !document.documentElement.doScroll)) {
  startApp();
} else {
  document.addEventListener("DOMContentLoaded", startApp);
}



</script>
  <script src="assets/crel.min.js"></script>
  <script src="assets/jquery-3.3.1.min.js"></script>
  <script src='assets/pdfmake.min.js'></script>
  <script src='assets/vfs_fonts.js'></script>
  <script src="assets/titlecreator.js?ver=1.15"></script>
</html>
