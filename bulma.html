<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?2=OmJ3Mz7X8k">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?2=OmJ3Mz7X8k">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?2=OmJ3Mz7X8k">
    <link rel="manifest" href="/site.webmanifest?2=OmJ3Mz7X8k">
    <link rel="mask-icon" href="/safari-pinned-tab.svg?2=OmJ3Mz7X8k" color="#eac03e">
    <link rel="shortcut icon" href="/favicon.ico?2=OmJ3Mz7X8k">
    <meta name="apple-mobile-web-app-title" content="Juke Studio">
    <meta name="application-name" content="Juke Studio">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="theme-color" content="#ffffff">

    <title>jukestudio</title>
    <link rel="stylesheet" href="assets/juke.css">
<style>
.is-center { text-align: center; }
#preview-strip { width: 25%; }
.navbar-brand img { height: 35px; width: auto; }
</style>
  </head>
  <body>
    <!-- START NAV -->
    <nav class="navbar is-danger">
      <div class="container">
        <div class="navbar-brand">
          <a class="navbar-item brand-text" href="#">
            <img src="images/logo.svg">
            <img src="images/brand.svg">
          </a>
          <div class="navbar-burger burger" data-target="navMenu">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
        <div id="navMenu" class="navbar-menu">
          <div class="navbar-start">
            <a class="navbar-item add-record" href="#">
              add record
            </a>
            <a class="navbar-item change-design" href="#">
              design
            </a>
            <a class="navbar-item" href="#">
              print
            </a>
          </div>
        </div>
      </div>
    </nav>
    <!-- END NAV -->
    <!-- MAIN CONTENT -->
    <section class="section">
      <div class="container">
        <div class="columns">
          <div class="column is-12">
            <div class="card events-card">
              <header class="card-header">
                <p class="card-header-title">
                  Records
                </p>
              </header>
              <div class="card-table">
                 <div class="content">
                    <table class="table is-fullwidth is-striped" id="record-table">
                      <thead>
                        <tr>
                          <th>Print</th>
                          <th>Side A</th>
                          <th>Side B</th>
                          <th></th>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- END MAIN CONTENT -->

    <!-- MODALS -->

    <!-- WELCOME MODAL -->
    <div class="modal" id="welcome-modal">
      <div class="modal-background close-modal"></div>
        <div class="modal-card modal-small is-center">
          <header class="modal-card-head">
            <p class="modal-card-title">
              welcome to jukestudio
            </p>
          </header>
          <section class="modal-card-body">
            <img src="images/logo.svg" id="preview-strip">
            <p>to get started, click 'add record' menu to add your first record, then set some design options and click 'print'!</p>
          </section>
          <footer class="modal-card-foot columns">
            <button class="button column is-light close-modal">ok, i'm ready!</button>
          </footer>
        </div>
      </div>
    </div>
    <!-- END WELCOME MODAL -->

    <!-- DESIGN MODAL -->
    <div class="modal" id="design-modal">
      <div class="modal-background close-modal"></div>
        <div class="modal-card modal-small">
          <header class="modal-card-head is-center">
            <p class="modal-card-title">
              <img class="modal-card-head-img" src="images/design-dark.svg"/>
              <br>
              <span class="title-text">design</span>
            </p>
          </header>
          <section class="modal-card-body">
            <p class="is-center">
            <img src="" style="width: 25%;" id="design-preview" class="svg" />
            </p>
            <div class="field">
              <label class="label">paper type</label>
              <div class="control">
                <div class="select">
                  <select id="design-paper-type">
                    <option value="letter">plain paper (US LETTER)</option>
                    <option value="double10">pre-printed 5x2 (HxW)</option>
                    <option value="single12">pre-printed 12x1 (HxW)</option>
                  </select>
                </div>
              </div>
              <p id="paperType-message"></p>
            </div>
            <div class="field">
              <label class="label">font</label>
              <div class="control">
                <div class="select">
                  <select id="design-font">
                  </select>
                </div>
              </div>
            </div>
            <div class="field">
              <input class="is-checkradio" id="design-uppercase" type="checkbox" name="">
              <label for="design-uppercase">force uppercase</label>
            </div>
            <div class="field">
              <input class="is-checkradio" id="design-quotes" type="checkbox" name="">
              <label for="design-quotes">put quotes around titles</label>
            </div>
            <div class="field">
              <label class="label">style</label>
              <div class="control">
                <div class="select">
                  <select class="onlyplain" id="design-style">
                  </select>
                </div>
              </div>
            </div>
            <div class="field">
              <label class="label">color</label>
              <div class="control">
                <div class="select">
                  <select class="onlyplain" id="design-primary-color">
                    <option value="#ff0000">red</option>
                    <option value="#00a0de">blue</option>
                    <option value="#5fae6f">green</option>
                    <option value="#80578f">purple</option>
                    <option value="#EE6B3F">orange</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="field">
              <input class="is-checkradio" id="design-artist-fill" type="checkbox" name="">
              <label for="design-artist-fill">colored background for artist</label>
            </div>
            <div class="field">
              <input class="is-checkradio" id="design-title-fill" type="checkbox" name="">
              <label for="design-title-fill">colored background for title</label>
            </div>
          </section>
          <footer class="modal-card-foot columns">
            <button class="button column is-light close-modal">cancel</button>
            <button class="button column is-success save">save</button>
          </footer>
        </div>
      </div>
    </div>
    <!-- END DESIGN MODAL -->

    <!-- ADD RECORD MODAL -->
    <div class="modal" id="add-record-modal">
      <div class="modal-background close-modal"></div>
        <div class="modal-card modal-small is-center">
          <header class="modal-card-head">
            <p class="modal-card-title">
              <img class="modal-card-head-img" src="images/record-dark.svg"/>
              <br>
              <span class="title-text">add record</span>
            </p>
          </header>
          <section class="modal-card-body">
            <p class="is-center">
              <img src="" id="add-record-preview" class="preview-strip" />
            </p>
            <div class="field">
              <div class="control">
                <input class="input" type="text" id="add-side-a" placeholder="side a">
              </div>
            </div>
            <div class="field">
              <div class="control">
                <input class="input" type="text" id="add-side-b" placeholder="side b">
              </div>
            </div>
            <div class="field">
              <div class="control">
                <input class="input" type="text" id="add-artist" placeholder="artist">
              </div>
            </div>
            <div class="field">
              <div class="control">
                <input class="input" type="text" id="add-artist-b" placeholder="side b artist (if different)">
              </div>
            </div>
            <div class="box" id="style-override">
              <div class="field">
                <input class="is-checkradio" id="title-style-override" type="checkbox" name="">
                <label for="title-style-override">alter style for this record</label>
              </div>
              <div class="field">
                <label class="label">style</label>
                <div class="control">
                  <div class="select">
                    <select id="title-style">
                    </select>
                  </div>
                </div>
              </div>
              <div class="field">
                <label class="label">color</label>
                <div class="control">
                  <div class="select">
                    <select id="title-primary-color">
                      <option value="#ff0000">red</option>
                      <option value="#00a0de">blue</option>
                      <option value="#5fae6f">green</option>
                      <option value="#80578f">purple</option>
                      <option value="#EE6B3F">orange</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="field">
                <input class="is-checkradio" id="title-artist-fill" type="checkbox" name="">
                <label for="title-artist-fill">colored background for artist</label>
              </div>
              <div class="field">
                <input class="is-checkradio" id="title-title-fill" type="checkbox" name="">
                <label for="title-title-fill">colored background for title</label>
              </div>
            </div>
          </section>
          <footer class="modal-card-foot columns">
            <button class="button column is-light close-modal">cancel</button>
            <button class="button column is-success save">save</button>
          </footer>
        </div>
      </div>
    </div>
    <!-- END ADD RECORD MODAL -->

    <!-- DELETE MODAL -->
    <div class="modal" id="delete-modal">
      <div class="modal-background close-modal"></div>
        <div class="modal-card modal-small is-center">
          <header class="modal-card-head">
            <p class="modal-card-title">
              <img class="modal-card-head-img" src="images/record-dark.svg"/>
              <br>
              delete record
            </p>
          </header>
          <section class="modal-card-body">
            <p class="is-compact record-detail"></p>
            <br>
            <p>are you sure you want to delete this record?</p>
            <br>
          </section>
          <footer class="modal-card-foot columns">
            <button class="button column is-light close-modal">cancel</button>
            <button class="button column is-danger" id="delete-record">delete</button>
          </footer>
        </div>
      </div>
    </div>

    <!-- END MODALS -->
  </body>
  <script src="assets/crel.min.js"></script>
  <script src="assets/lokijs.min.js"></script>
  <script src="assets/jquery-3.3.1.min.js"></script>
  <script src='assets/pdfmake.min.js'></script>
  <script src='assets/vfs_fonts.js'></script>
  <script src="assets/titlecreatorb.js?ver=1.15"></script>
<script>

//----- HELPER FUNCTIONS
function startApp() {
  //add vfs fonts to the main page
  var style = document.createElement('style');
  style.type = 'text/css';
  var frag=document.createDocumentFragment();
  for(var key in pdfMake.vfs) {
    if(pdfMake.vfs.hasOwnProperty(key) && key.indexOf('.ttf')>0) {
      style.append('@font-face {font-family: '+key.substr(0,key.length-4)+';src: url(data:font/ttf;base64,'+pdfMake.vfs[key]+');}');
       frag.appendChild(crel('option',{'value':key.substr(0,key.length-4),'style':'font-family:'+key.substr(0,key.length-4)},key.substr(0,key.length-4)));
    }
  }
  document.getElementById('design-font').appendChild(frag);
  document.getElementsByTagName('head')[0].appendChild(style);

  //populate the list of styles from titleCreator
  var f1=document.createDocumentFragment(),f2=document.createDocumentFragment();
  var keys=Object.keys(titleCreator.styles);
  keys.forEach(function(key){
    f1.appendChild(crel('option',{'value':key},titleCreator.styles[key].name))
    f2.appendChild(crel('option',{'value':key},titleCreator.styles[key].name))
  });
  document.getElementById('design-style').appendChild(f1);
  document.getElementById('title-style').appendChild(f2);

  //load the titles into the app
  var titles=titleCreator.getTitles();
  if(titles.length>0)
    addRow(titles);
  else
    document.querySelector('#record-table tbody').append(crel('tr',{'id':'no-records'},crel('td',{'colspan':'4','class':'is-center'},'no records! add a record to get started')));

  //only show the welcome screen the first time you visit
  if(!localStorage.getItem('welcome-hidden'))
    document.getElementById('welcome-modal').classList.add('is-active');
}

function toggleModal(id,dataID=null) {
  var m=document.getElementById(id);
  if(m.classList.contains('is-active')) {
    m.classList.remove('is-active');
    m.removeAttribute('data-id')
  } else {
    m.classList.add('is-active');
    if(dataID!==null)
      m.setAttribute('data-id',dataID)
  }
}

function addRow(content=null){
  if(content==null) return;

  var row;
  var fragment=document.createDocumentFragment();

  if(content.constructor!==Array)
    content=[content];

  var i;
  for(i=0;i<content.length;i++) {
    row=crel('tr',{'class':'is-compact','data-id':content[i].id},
      crel('td',{'class':'is-middle'},
        crel('div',{'class':'field'},
          crel('input',{'class':'is-checkradio print-check','data-id':content[i].id,'id':'printcheck'+content[i].id,'type':'checkbox'}),
          crel('label',{'for':'printcheck'+content[i].id})
        )
      ), //td
      crel('td',{'class':'aside'},
        crel('p',
          crel('strong',content[i].aside)
        ),
        crel('p',
          crel('small',content[i].artist)
        )
      ), //td
      crel('td',{'class':'bside'},
        crel('p',
          crel('strong',content[i].bside)
        ),
        crel('p',
          crel('small',((content[i].artistb=='')?content[i].artist:content[i].artistb))
        )
      ), //td
      crel('td',{'class':'is-middle'},
        crel('a',{'class':'button is-small is-danger delete-button','href':'#','data-modal':'open','data-target':'delete-modal'},'delete')
      ) //td
    ); //tr
    fragment.appendChild(row);
  }

  var nr=document.querySelector('#record-table #no-records');
  if(nr!==null) nr.remove();

  document.querySelector('#record-table tbody').appendChild(fragment);
}

function removeRow(id) {
  var row=document.querySelector('#record-table tr[data-id="'+id+'"]');
  row.parentNode.removeChild(row);
  if(document.querySelector('#record-table tbody tr')==null)
    document.querySelector('#record-table tbody').innerHTML='<tr id="no-records"><td colspan=4 class="is-center">no records! add a record to get started</td></tr>';
}

function addSVGText(g,text,options) {
  var newText = document.createElementNS('http://www.w3.org/2000/svg',"text");
  if(Array.isArray(text)) {
    text.forEach(function(t,i){
       var tsp = document.createElementNS('http://www.w3.org/2000/svg',"tspan");
       tsp.setAttributeNS(null,'x',options["x"]);
       if(i>0)
        tsp.setAttributeNS(null,'dy','10px');
      var tn=document.createTextNode(t);
      tsp.appendChild(tn);
      newText.appendChild(tsp);
    });
    options["y"]=options["y"]-7;
  } else {
    var textNode = document.createTextNode(text);
    newText.appendChild(textNode);

    var k=Object.keys(options);
     k.forEach(function(key) {
       newText.setAttributeNS(null,key,options[key]);
     });
     g.append(newText);
   }
}

function stringBreaker(str,style) {
  var ts=document.body.appendChild(crel('span',{'style':'font-family:'+style.font.name+';font-size:'+style.font.titleSize+'px;font-weight:bold;position:absolute;left:0;top:0','id':'text-sizer'}));
  ts.innerText=str;
  if(ts.offsetWidth>(225-(style.margins*2))) {
    var x=str.split(" ");
    ts.innerText='';
    var i=0;
    for(i=0;i<x.length;i++) {
      ts.innerText=ts.innerText+(((i>0)?' ':'')+x[i]);
      if(ts.offsetWidth>(225-(style.margins*2))) {
        i=i-1;
        break;
      }
    }
    tt=[x.splice(i).join(" ")];
    x=x.join(" ");
    tt.unshift(x);
    str=tt;
    delete tt;
  }
  //ts.remove();
  return str;
}
function alterSVGText(img,text) {
  document.querySelector('#'+img+' .aside').textContent=text.sidea;
  document.querySelector('#'+img+' .bside').textContent=text.sideb;
  document.querySelector('#'+img+' .artist').textContent=text.artist;
}
function buildPreview(img,o) {
  img=document.getElementById(img);
  var imgID = img.id;
  var imgClass = img.classList;
  parser = new DOMParser();
  data=parser.parseFromString(atob(pdfMake.vfs[o.style.style+'.svg']),"text/xml");
  var svg = data.querySelector('svg');
  if(typeof imgID !== 'undefined') {
    svg.id=imgID;
  }
  for(var i=0;i<imgClass.length;i++) svg.classList.add(imgClass[i]);
  svg.classList.add('replaced-svg');
  svg.removeAttribute('xmlns:a');
  if(!svg.getAttribute('viewBox') && svg.getAttribute('height') && svg.getAttribute('width')) {
    svg.setAttribute('viewBox', '0 0 ' + svg.getAttribute('height') + ' ' + svg.getAttribute('width'))
  }

  if(!o.artistTint) {
    o.style.artistTint=((o.style.artistFillColor)?shadeColor2(o.style.primaryColor,0.8):'#ffffff');
    o.style.titleTint=((o.style.titleFillColor)?shadeColor2(o.style.primaryColor,0.8):'#ffffff');
  }
  var des=svg.querySelector('#design');
  if(des!==null) {
    des.style.fill=o.style.primaryColor;
    if(o.style.artistFillColor) svg.querySelector('#artist_fill').style.fill=o.style.artistTint;
    if(o.style.titleFillColor) svg.querySelector('#title_fill').style.fill=o.style.titleTint;
  }

  var g=svg.querySelector('g');
  var options={"x":112.5,"y":19,"text-anchor":"middle","font-size":o.style.font.titleSize+"px","font-family":o.style.font.name,"class":"aside"};
  addSVGText(g,stringBreaker(o.aside,o.style),options);

  options["y"]=61;
  options["class"]="bside"
  addSVGText(g,stringBreaker(o.bside,o.style),options);

  options["y"]=37;
  options["alignment-baseline"]="central";
  options["font-size"]=o.style.font.artistSize+"px";
  options["class"]="artist"
  addSVGText(g,o.artist+((o.artistb=='')?'':' / '+o.artistb),options);

  img.replaceWith(svg);

  
};

//----- END HELPER FUNCTIONS

//----- EVENT HANDLERS

//-- GENERIC CLOSE MODAL HANDLER --//
document.querySelectorAll('.close-modal').forEach(function(e){
  e.addEventListener('click', function (event) {
    var modal=event.target.closest('.modal');
    toggleModal(modal.id);
    if(modal.id=='welcome-modal')
      localStorage.setItem('welcome-hidden',true);
    else if(modal.id=="add-record-modal")
      document.querySelectorAll('#add-record-modal input').forEach(function(e){e.value=''});
  });
});

//-- DESIGN MODAL OPENER --//
document.querySelector('.navbar .change-design').addEventListener('click', function(event) {
  event.preventDefault();
  var o=titleCreator.getOptions();
  document.getElementById('design-paper-type').value=o.paperType;
  document.getElementById('design-font').value=o.font;
  document.getElementById('design-uppercase').checked=o.allCaps;
  document.getElementById('design-quotes').checked=o.quotes;
  document.getElementById('design-style').value=o.style;
  document.getElementById('design-primary-color').value=o.primaryColor;
  document.getElementById('design-artist-fill').checked=o.artistFillColor;
  document.getElementById('design-title-fill').checked=o.titleFillColor;
  buildPreview('design-preview',titleCreator.getTitle(false,true));
  toggleModal('design-modal');
});
//-- DESIGN MODAL UPDATE SVG --//
document.querySelectorAll('#design-paper-type,#design-font,#design-uppercase,#design-quotes,#design-style,#design-primary-color,#design-artist-fill,#design-title-fill').forEach(function(e){
  e.addEventListener('change', function(event) {
    s=titleCreator.getTitle(false,true);
    s.style.allCaps=document.getElementById('design-uppercase').checked;
    s.style.artistFillColor=document.getElementById('design-artist-fill').checked;
    s.style.font.name=document.getElementById('design-font').value;
    s.style.primaryColor=document.getElementById('design-primary-color').value;
    s.style.style=document.getElementById('design-style').value;
    s.style.quotes=document.getElementById('design-quotes').checked;
    s.style.titleFillColor=document.getElementById('design-title-fill').checked;
    s.aside=((s.style.quotes)?'"':'')+((s.style.allCaps)?'SIDE A':'Side A')+((s.style.quotes)?'"':'');
    s.bside=((s.style.quotes)?'"':'')+((s.style.allCaps)?'SIDE B':'Side B')+((s.style.quotes)?'"':'');
    s.artist=((s.style.allCaps)?'ARTIST':'Artist');
    buildPreview('design-preview',s);
  });
});
//-- DESIGN MODAL SAVE --//
document.querySelector('#design-modal .save').addEventListener('click', function(event) {
  titleCreator.setOption('paperType',document.getElementById('design-paper-type').value);
  titleCreator.setOption('font',document.getElementById('design-font').value);
  titleCreator.setOption('allCaps',document.getElementById('design-uppercase').checked);
  titleCreator.setOption('quotes',document.getElementById('design-quotes').checked);
  titleCreator.setOption('style',document.getElementById('design-style').value);
  titleCreator.setOption('primaryColor',document.getElementById('design-primary-color').value);
  titleCreator.setOption('artistFillColor',document.getElementById('design-artist-fill').checked);
  titleCreator.setOption('titleFillColor',document.getElementById('design-title-fill').checked);
  toggleModal('design-modal');
});

//-- ADD RECORD OPENER --//
document.querySelector('.navbar .add-record').addEventListener('click', function(event) {
  event.preventDefault();
  document.querySelector('#add-record-modal .title-text').innerText='add record';
  var s=titleCreator.getStyle();
  document.getElementById('title-style').value=s.style;
  document.getElementById('title-primary-color').value=s.primaryColor;
  document.getElementById('title-artist-fill').checked=s.artistFillColor;
  document.getElementById('title-title-fill').checked=s.titleFillColor;
  document.getElementById('title-style-override').checked=false;
  document.querySelectorAll('#add-record-modal .box input,#add-record-modal .box select').forEach(function(e){
    if(e.id!=='title-style-override')
      e.disabled=true;
  });

  //clear the existing fields
  var mand=['add-side-a','add-side-b','add-artist'];
  mand.forEach(function(v){ document.getElementById(v).value='' });

  var t=titleCreator.getTitle(false,true);
  t.aside='';
  t.bside='';
  t.artist='';
  buildPreview('add-record-preview',t);
  toggleModal('add-record-modal');
  document.querySelector("#add-side-a").focus();
});
//-- UPDATE SVG TEXT WHEN ADD INPUTS CHANGE --//
document.querySelectorAll('#add-side-a,#add-side-b,#add-artist,#add-artist-b').forEach(function(e){
  e.addEventListener('keyup', function(event) {
    s=titleCreator.getTitle(false,true);
    var art=document.getElementById('add-artist').value+((document.getElementById('add-artist-b').value=='')?'':' / '+document.getElementById('add-artist-b').value);
    s.aside=((s.style.quotes)?'"':'')+((s.style.allCaps)?document.getElementById('add-side-a').value.toUpperCase():document.getElementById('add-side-a').value)+((s.style.quotes)?'"':''),
    s.bside=((s.style.quotes)?'"':'')+((s.style.allCaps)?document.getElementById('add-side-b').value.toUpperCase():document.getElementById('add-side-b').value)+((s.style.quotes)?'"':''),
    s.artist=((s.style.allCaps)?art.toUpperCase():art)
    buildPreview('add-record-preview',s);
  });
});
//-- STYLE OVERRRIDE (ADD RECORD) --//
document.getElementById('title-style-override').addEventListener('click',function(e){
  document.querySelectorAll('#add-record-modal .box input,#add-record-modal .box select').forEach(function(e){
    if(e.id!=='title-style-override')
      e.disabled=!document.getElementById('title-style-override').checked;
  });
});
document.querySelector('#add-record-modal .save').addEventListener('click',function(event) {
  var mand=['add-side-a','add-side-b','add-artist'],
      cancel=false;
  mand.forEach(function(v){
    var input=document.getElementById(v);
    if(input.value=='') {
      input.classList.add('is-danger');//.parent().addClass('has-danger').find('.invalid-feedback').text('Please enter a value');
      if(input.parentNode.querySelector('.help')==null)
        input.parentNode.appendChild(crel('p',{'class':'help is-danger'},'This field is required'));
      cancel=true;
    } else {
      input.classList.remove('is-danger');
      var h=input.parentNode.querySelector('.help');
      if(h!==null)
        h.remove();
    }
  });

  if(cancel) return false;

  var t={
    aside:document.getElementById('add-side-a').value,
    bside:document.getElementById('add-side-b').value,
    artist:document.getElementById('add-artist').value,
    artistb:document.getElementById('add-artist-b').value
  };

  if(document.getElementById('title-style-override').checked) {
    //correct formatting
    var o=titleCreator.getOptions();
    var x=document.getElementById('title-primary-color').value;
    if(x!=o.primaryColor) 
      t.primaryColor=x;
    else
      delete(t['primaryColor']);

    x=document.getElementById('title-style').value;
    if(x!=o.style) 
      t.style=x;
    else
      delete(t['style']);

    x=document.getElementById('title-artist-fill').checked;
    if(x!=o.artistFillColor) 
      t.artistFillColor=x;
    else
      delete(t['artistFillColor']);

    x=document.getElementById('title-title-fill').checked;
    if(x!=o.titleFillColor)
      t.titleFillColor=x;
    else
      delete(t['titleFillColor']);
  }

  var dl=document.getElementById('add-record-modal').dataset;
  if(dl.hasOwnProperty('id')) {
    t.id=dl['id'];
    titleCreator.updateTitle(t);
    var c=document.querySelector('#record-table tr[data-id="'+t.id+'"]');
    c.querySelector('.aside strong').innerText=t.aside;
    c.querySelector('.aside small').innerText=t.artist;
    c.querySelector('.bside strong').innerText=t.bside;
    c.querySelector('.bside small').innerText=((t.artistb!='')?t.artistb:t.artist);
  } else {
    t=titleCreator.addTitles([t]);
    addRow(t[0]);
  }
  toggleModal('add-record-modal');
});

//-- TABLE ROW CLICK (DELETE/EDIT) --//
document.querySelectorAll('#record-table tbody').forEach(function(e){
  e.addEventListener('click', function (event) {
    var id=event.target.closest('tr').dataset.id;
    if(event.target.classList.contains('delete-button')) {
      event.preventDefault();
      var rd=document.querySelector('#delete-modal .record-detail');
      while(rd.firstChild) { rd.removeChild(rd.firstChild) }
      var td=event.target.parentNode.parentNode.childNodes[1].cloneNode(true);
      while(td.childNodes.length)
        rd.appendChild(td.childNodes[0]);
      toggleModal('delete-modal',id);
    } else {
      //edit the record
      document.querySelector('#add-record-modal .title-text').innerText='edit record';
      var t=titleCreator.getTitle(id);
      var s=titleCreator.getStyle();
      document.getElementById('add-side-a').value=t.aside;
      document.getElementById('add-side-b').value=t.bside;
      document.getElementById('add-artist').value=t.artist;
      document.getElementById('add-artist-b').value=t.artistb;
      var override=false;
      ['style','primaryColor','artistFillColor','titleFillColor'].forEach(function(e) {
        if(t.hasOwnProperty(e)) {
          override=true;
          switch(e) {
            case 'style': document.getElementById('title-style').value=t.style; break;
            case 'primaryColor': document.getElementById('title-primary-color').value=t.primaryColor; break;
            case 'artistFillColor': document.getElementById('title-artist-fill').value=t.artistFillColor; break;
            case 'titleFillColor': document.getElementById('title-title-fill').value=t.titleFillColor; break;
          }
        }
      });
      document.querySelectorAll('#style-override input, #style-override select').forEach(function(e){
        if(e.id!=='title-style-override')
          e.disabled=!override;
      });
      document.getElementById('title-style-override').checked=override;
      buildPreview('add-record-preview',titleCreator.getTitle(id,true));
      toggleModal('add-record-modal',id);

    }
  });
});
//-- DELETE RECORD --//
document.getElementById('delete-record').addEventListener('click',function(e){
  var id=document.getElementById('delete-modal').dataset.id;
  if(id!==undefined) {
    titleCreator.removeTitle(id);
    removeRow(id);
    document.getElementById('delete-modal').classList.remove('is-active'); 
  }
});
//----- END EVENT HANDLERS


//----- DETECT WHEN DOM IS LOADED AND START APP
/*
if (document.readyState === "complete" || (document.readyState !== "loading" && !document.documentElement.doScroll)) {
  startApp();
} else {
  document.addEventListener("DOMContentLoaded", startApp);
}
*/
</script>
</html>
